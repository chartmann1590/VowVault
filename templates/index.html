{% extends "base.html" %}

{% block title %}Wedding Gallery - Home{% endblock %}

{% block extra_styles %}
<style>
    .gallery-header {
        text-align: center;
        margin-bottom: 3rem;
    }

    .gallery-header h2 {
        font-family: 'Playfair Display', serif;
        font-size: 3rem;
        color: #8b7355;
        margin-bottom: 1rem;
    }

    .gallery-header p {
        color: #6b5d54;
        font-size: 1.2rem;
    }

    .photo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 2rem;
        margin-top: 2rem;
    }

    .photo-card {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 5px 30px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
    }

    .photo-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    }

    .photo-wrapper {
        position: relative;
        padding-bottom: 75%;
        overflow: hidden;
        background: #f0f0f0;
    }

    .photo-wrapper img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .photo-card:hover .photo-wrapper img {
        transform: scale(1.05);
    }

    /* Video indicator overlay */
    .video-indicator {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 60px;
        height: 60px;
        background: rgba(0, 0, 0, 0.7);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        pointer-events: none;
    }

    .video-indicator svg {
        width: 30px;
        height: 30px;
        fill: white;
        margin-left: 3px;
    }

    .video-duration {
        position: absolute;
        bottom: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.85rem;
        pointer-events: none;
    }

    .media-type-badge {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(139, 115, 85, 0.9);
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .photobooth-badge {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(23, 162, 184, 0.9);
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .photo-info {
        padding: 1.5rem;
    }

    .photo-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
    }

    .uploader-name {
        font-weight: 600;
        color: #8b7355;
    }

    .upload-date {
        color: #999;
        font-size: 0.9rem;
    }

    .photo-stats {
        display: flex;
        gap: 1.5rem;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #f0f0f0;
    }

    .stat-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #6b5d54;
        font-size: 0.9rem;
    }

    .stat-item svg {
        width: 20px;
        height: 20px;
        fill: currentColor;
    }

    .empty-state {
        text-align: center;
        padding: 4rem 0;
    }

    .empty-state h3 {
        font-family: 'Playfair Display', serif;
        font-size: 2rem;
        color: #8b7355;
        margin-bottom: 1rem;
    }

    .empty-state p {
        color: #6b5d54;
        font-size: 1.1rem;
        margin-bottom: 2rem;
    }

    .description-preview {
        color: #666;
        font-size: 0.95rem;
        margin-top: 0.5rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* Modal Styles */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        padding: 20px;
    }

    .modal-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    .modal-content {
        background: white;
        border-radius: 20px;
        max-width: 600px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        transform: scale(0.9);
        transition: transform 0.3s ease;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .modal-overlay.active .modal-content {
        transform: scale(1);
    }

    .modal-header {
        background: linear-gradient(135deg, #f5e6d3 0%, #f9f5f0 100%);
        padding: 2.5rem;
        text-align: center;
        border-radius: 20px 20px 0 0;
    }

    .modal-header h2 {
        font-family: 'Playfair Display', serif;
        font-size: 2.5rem;
        color: #8b7355;
        margin: 0;
    }

    .modal-body {
        padding: 2.5rem;
    }

    .couple-photo {
        width: 100%;
        max-width: 400px;
        margin: 0 auto 2rem;
        display: block;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .welcome-message {
        font-size: 1.1rem;
        line-height: 1.8;
        color: #555;
        text-align: center;
        margin-bottom: 2rem;
    }

    .instructions-section {
        background: #f9f5f0;
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 2rem;
    }

    .instructions-title {
        font-family: 'Playfair Display', serif;
        font-size: 1.5rem;
        color: #8b7355;
        margin-bottom: 1rem;
        text-align: center;
    }

    .instructions-list {
        list-style: none;
        padding: 0;
    }

    .instructions-list li {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        margin-bottom: 1rem;
        color: #666;
        line-height: 1.6;
    }

    .instructions-list li::before {
        content: "âœ¨";
        font-size: 1.2rem;
        flex-shrink: 0;
    }

    .modal-footer {
        padding: 0 2.5rem 2.5rem;
        text-align: center;
    }

    .modal-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    .email-upload-section {
        margin-top: 2rem;
        padding: 1.5rem;
        background: linear-gradient(135deg, #f9f5f0 0%, #f5e6d3 100%);
        border-radius: 15px;
        border-left: 4px solid #8b7355;
    }

    .email-upload-title {
        color: #8b7355;
        font-size: 1.3rem;
        margin-bottom: 1rem;
        font-family: 'Playfair Display', serif;
    }

    .email-upload-text {
        color: #6b5d54;
        margin-bottom: 1rem;
        line-height: 1.5;
    }

    .email-instructions {
        background: white;
        padding: 1rem;
        border-radius: 10px;
        border: 1px solid #e0d5c5;
    }

    .email-instructions p {
        margin-bottom: 0.5rem;
        color: #6b5d54;
    }

    .email-instructions ol {
        margin: 0.5rem 0;
        padding-left: 1.5rem;
        color: #6b5d54;
    }

    .email-instructions li {
        margin-bottom: 0.3rem;
        line-height: 1.4;
    }

    .email-note {
        margin-top: 1rem !important;
        padding: 0.5rem;
        background: #fff3cd;
        border-radius: 5px;
        border-left: 3px solid #ffc107;
        font-size: 0.9rem;
    }

    .close-modal-btn {
        background: #8b7355;
        color: white;
        border: none;
        padding: 1rem 3rem;
        border-radius: 30px;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
    }

    .close-modal-btn:hover {
        background: #6b5d54;
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(139, 115, 85, 0.3);
    }

    .guestbook-modal-btn {
        background: #e8ddd3;
        color: #6b5d54;
        border: none;
        padding: 1rem 2rem;
        border-radius: 30px;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
        text-decoration: none;
        display: inline-block;
    }

    .guestbook-modal-btn:hover {
        background: #d4c4b5;
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(232, 221, 211, 0.3);
    }

    .copy-email-btn {
        background: #f0f0f0;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 2px 6px;
        font-size: 0.9rem;
        cursor: pointer;
        margin-left: 5px;
        transition: background-color 0.2s ease;
    }

    .copy-email-btn:hover {
        background: #e0e0e0;
    }

    @media (max-width: 768px) {
        .gallery-header h2 {
            font-size: 2rem;
        }

        .photo-grid {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .modal-header h2 {
            font-size: 2rem;
        }

        .modal-header {
            padding: 1.5rem;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-actions {
            flex-direction: column;
        }

        .modal-actions > * {
            width: 100%;
        }

        .close-modal-btn, .guestbook-modal-btn {
            padding: 0.75rem 2rem;
            font-size: 1rem;
        }

        .instructions-section {
            padding: 1.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Welcome Modal -->
{% if show_modal %}
<div class="modal-overlay" id="welcomeModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>{{ welcome_settings.get('title', 'Welcome to Our Wedding Gallery!') }}</h2>
        </div>
        <div class="modal-body">
            {% if welcome_settings.get('couple_photo') %}
            <img src="{{ welcome_settings.get('couple_photo') }}" alt="Couple Photo" class="couple-photo">
            {% endif %}
            
            <p class="welcome-message">
                {{ welcome_settings.get('message', 'Thank you so much for celebrating with us! We\'d love to see the wedding through your eyes. Feel free to upload your photos and browse the gallery.') }}
            </p>
            
            {% if welcome_settings.get('instructions') %}
            <div class="instructions-section">
                <h3 class="instructions-title">How to Use the Gallery</h3>
                <ul class="instructions-list">
                    {% for instruction in welcome_settings.get('instructions', []) %}
                    <li>{{ instruction }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <div class="email-upload-section">
                <h3 class="email-upload-title">ðŸ“§ Email Your Photos</h3>
                <p class="email-upload-text">
                    Can't upload right now? No problem! You can email your photos to us and we'll add them to the gallery automatically.
                </p>
                <div class="email-instructions">
                    <p><strong>How to email photos:</strong></p>
                    <ol>
                        <li>Attach your photos to an email</li>
                        <li>Send to: 
                            <strong id="emailAddress">{{ email_settings.monitor_email if email_settings.monitor_email else 'your-email@example.com' }}</strong>
                            <button class="copy-email-btn" onclick="copyEmail()" title="Copy email address">
                                ðŸ“‹
                            </button>
                        </li>
                        <li>We'll automatically add them to the gallery</li>
                        <li>You'll receive a confirmation email with a link</li>
                    </ol>
                    <p class="email-note">ðŸ“¸ <em>Only photo files (JPG, PNG, GIF, WebP) are accepted</em></p>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <div class="modal-actions">
                <a href="{{ url_for('sign_guestbook') }}" class="guestbook-modal-btn">Sign Our Guestbook</a>
                <button class="close-modal-btn" onclick="closeWelcomeModal()">Enter Gallery</button>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="gallery-header">
    <h2>Our Wedding Memories</h2>
    <p>Share and relive the beautiful moments from our special day</p>
</div>

{% if photos %}
    <div class="photo-grid">
        {% for photo in photos %}
        <div class="photo-card" onclick="window.location.href='{{ url_for('view_photo', photo_id=photo.id) }}'">
            <div class="photo-wrapper">
                {% if photo.media_type == 'video' %}
                    {% if photo.thumbnail_filename %}
                        <img src="{{ url_for('static', filename='uploads/thumbnails/' + photo.thumbnail_filename) }}" 
                             alt="Video by {{ photo.uploader_name }}"
                             loading="lazy">
                    {% else %}
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Crect width='400' height='300' fill='%23f0f0f0'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='%23999' font-family='sans-serif' font-size='16'%3EVideo Preview%3C/text%3E%3C/svg%3E" 
                             alt="Video by {{ photo.uploader_name }}">
                    {% endif %}
                    <div class="video-indicator">
                        <svg viewBox="0 0 24 24">
                            <path d="M8,5.14V19.14L19,12.14L8,5.14Z"/>
                        </svg>
                    </div>
                    {% if photo.duration %}
                    <div class="video-duration">{{ '%d:%02d' | format((photo.duration // 60)|int, (photo.duration % 60)|int) }}</div>
                    {% endif %}
                    <div class="media-type-badge">Video</div>
                {% elif photo.is_photobooth %}
                    <img src="{{ url_for('static', filename='uploads/photobooth/' + photo.filename) }}" 
                         alt="Photobooth by {{ photo.uploader_name }}"
                         loading="lazy">
                    <div class="photobooth-badge">Photobooth</div>
                {% else %}
                    <img src="{{ url_for('static', filename='uploads/' + photo.filename) }}" 
                         alt="Photo by {{ photo.uploader_name }}"
                         loading="lazy">
                {% endif %}
            </div>
            <div class="photo-info">
                <div class="photo-meta">
                    <span class="uploader-name">{{ photo.uploader_name }}</span>
                    <span class="upload-date">{{ photo.upload_date.strftime('%b %d, %Y') }}</span>
                </div>
                {% if photo.description %}
                <p class="description-preview">{{ photo.description }}</p>
                {% endif %}
                <div class="photo-stats">
                    <div class="stat-item">
                        <svg viewBox="0 0 24 24">
                            <path d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z"/>
                        </svg>
                        <span>{{ photo.likes }}</span>
                    </div>
                    <div class="stat-item">
                        <svg viewBox="0 0 24 24">
                            <path d="M9,22A1,1 0 0,1 8,21V18H4A2,2 0 0,1 2,16V4C2,2.89 2.9,2 4,2H20A2,2 0 0,1 22,4V16A2,2 0 0,1 20,18H13.9L10.2,21.71C10,21.9 9.75,22 9.5,22V22H9Z"/>
                        </svg>
                        <span>{{ photo.comments|length }}</span>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="empty-state">
        <h3>No photos or videos yet!</h3>
        <p>Be the first to share a memory from our special day</p>
        <a href="{{ url_for('upload') }}" class="btn">Upload First Photo/Video</a>
    </div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    // Show modal on page load if needed
    {% if show_modal %}
    window.addEventListener('load', function() {
        setTimeout(() => {
            document.getElementById('welcomeModal').classList.add('active');
        }, 100);
    });
    {% endif %}

    function closeWelcomeModal() {
        const modal = document.getElementById('welcomeModal');
        modal.classList.remove('active');
        
        // Mark as seen
        fetch('/api/mark-welcome-seen', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });
    }

    // Close modal when clicking outside
    document.getElementById('welcomeModal')?.addEventListener('click', function(e) {
        if (e.target === this) {
            closeWelcomeModal();
        }
    });

    function copyEmail() {
        const emailAddress = document.getElementById('emailAddress').textContent;
        navigator.clipboard.writeText(emailAddress).then(() => {
            alert('Email address copied to clipboard!');
        }).catch(err => {
            console.error('Failed to copy email address: ', err);
        });
    }
</script>
{% endblock %}