{% extends "base.html" %}

{% block title %}Admin - Photo of the Day Management{% endblock %}

{% block extra_styles %}
<style>
    .photo-of-day-admin-header {
        text-align: center;
        margin-bottom: 3rem;
    }
    .photo-of-day-admin-header h1 {
        font-family: 'Playfair Display', serif;
        font-size: 2.5rem;
        color: #8b7355;
        margin-bottom: 0.5rem;
    }
    .photo-of-day-admin-header p {
        color: #6b5d54;
        font-size: 1.1rem;
    }
    .admin-stats-grid {
        display: flex;
        gap: 2rem;
        margin-bottom: 2.5rem;
        justify-content: center;
        flex-wrap: wrap;
    }
    .admin-stat-card {
        background: #f9f5f0;
        border-radius: 15px;
        box-shadow: 0 4px 24px rgba(0,0,0,0.07);
        padding: 2rem 2.5rem;
        text-align: center;
        min-width: 180px;
    }
    .admin-stat-card .stat-value {
        font-size: 2.2rem;
        font-weight: 700;
        color: #e91e63;
        margin-bottom: 0.3rem;
    }
    .admin-stat-card .stat-label {
        color: #8b7355;
        font-size: 1.1rem;
    }
    .admin-section-card {
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        margin-bottom: 2.5rem;
        padding: 2.5rem 2rem;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
    }
    .admin-section-title {
        font-family: 'Playfair Display', serif;
        font-size: 2rem;
        color: #8b7355;
        margin-bottom: 2rem;
        text-align: left;
    }
    .admin-controls {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
    }
    .admin-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1rem;
        font-weight: 600;
        border: none;
        border-radius: 8px;
        padding: 0.8rem 1.5rem;
        cursor: pointer;
        transition: background 0.2s;
        text-decoration: none;
        color: #fff;
    }
    .admin-btn.primary {
        background: #e91e63;
    }
    .admin-btn.primary:hover {
        background: #c2185b;
    }
    .admin-btn.secondary {
        background: #8b7355;
    }
    .admin-btn.secondary:hover {
        background: #6b5d54;
    }
    .admin-btn.success {
        background: #4caf50;
    }
    .admin-btn.success:hover {
        background: #388e3c;
    }
    .admin-btn.danger {
        background: #f44336;
    }
    .admin-btn.danger:hover {
        background: #d32f2f;
    }
    .admin-btn.warning {
        background: #ff9800;
    }
    .admin-btn.warning:hover {
        background: #f57c00;
    }
    .todays-photos-display {
        background: #f9f5f0;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
    }
    .todays-photos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-top: 1rem;
    }
    .todays-photo-card {
        background: white;
        border-radius: 10px;
        padding: 1rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        position: relative;
    }
    .todays-photo-card img,
    .todays-photo-card video {
        max-width: 100%;
        max-height: 200px;
        border-radius: 8px;
        display: block;
        margin: 0 auto;
    }
    .todays-photo-info {
        margin-top: 1rem;
        color: #8b7355;
        text-align: center;
    }
    .position-badge {
        position: absolute;
        top: 8px;
        left: 8px;
        background: #e91e63;
        color: #fff;
        padding: 0.2rem 0.6rem;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 600;
    }
    .photo-selection-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-top: 2rem;
    }
    .photo-selection-card {
        background: #f9f5f0;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 24px rgba(0,0,0,0.07);
        transition: box-shadow 0.2s;
        cursor: pointer;
        position: relative;
    }
    .photo-selection-card:hover {
        box-shadow: 0 8px 32px rgba(233, 30, 99, 0.13);
    }
    .photo-selection-card.selected {
        border: 3px solid #e91e63;
        box-shadow: 0 8px 32px rgba(233, 30, 99, 0.2);
    }
    .photo-selection-media {
        position: relative;
        height: 200px;
    }
    .photo-selection-media img,
    .photo-selection-media video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }
    .photo-selection-info {
        padding: 1rem;
    }
    .photo-selection-uploader {
        color: #8b7355;
        font-size: 0.9rem;
        margin-bottom: 0.3rem;
    }
    .photo-selection-stats {
        display: flex;
        justify-content: space-between;
        color: #6b5d54;
        font-size: 0.8rem;
    }
    .position-selector {
        display: flex;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }
    .position-btn {
        padding: 0.3rem 0.8rem;
        border: 2px solid #e91e63;
        background: transparent;
        color: #e91e63;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }
    .position-btn:hover,
    .position-btn.active {
        background: #e91e63;
        color: #fff;
    }
    .recent-photos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 2rem;
    }
    .recent-photo-card {
        background: #f9f5f0;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 24px rgba(0,0,0,0.07);
        position: relative;
    }
    .recent-photo-media {
        position: relative;
        height: 200px;
    }
    .recent-photo-media img,
    .recent-photo-media video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }
    .recent-photo-date {
        position: absolute;
        top: 12px;
        right: 12px;
        background: #e91e63;
        color: #fff;
        padding: 0.3rem 0.9rem;
        border-radius: 8px;
        font-size: 0.9rem;
        font-weight: 600;
    }
    .recent-photo-info {
        padding: 1rem 1.2rem 0.7rem 1.2rem;
    }
    .recent-photo-info .uploader {
        color: #8b7355;
        font-size: 1rem;
        margin-bottom: 0.3rem;
    }
    .recent-photo-info .stats {
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: #6b5d54;
        font-size: 0.9rem;
    }
    .no-photo-message {
        text-align: center;
        padding: 3rem 2rem;
        color: #6b5d54;
    }
    .no-photo-message .icon {
        font-size: 4rem;
        margin-bottom: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="photo-of-day-admin-header">
    <h1>üì∏ Photo of the Day Management</h1>
    <p>Manage today's featured photos and view recent selections</p>
</div>

<div class="admin-stats-grid">
    <div class="admin-stat-card">
        <div class="stat-value">{{ recent_photos|length }}</div>
        <div class="stat-label">Total Photos of the Day</div>
    </div>
    <div class="admin-stat-card">
        <div class="stat-value">{{ all_photos|length }}</div>
        <div class="stat-label">Available Photos</div>
    </div>
    <div class="admin-stat-card">
        <div class="stat-value">{{ todays_photos|length }}</div>
        <div class="stat-label">Today's Photos</div>
    </div>
</div>

<div class="admin-section-card">
    <div class="admin-section-title">Today's Photos of the Day</div>
    
    {% if todays_photos %}
    <div class="todays-photos-display">
        <div class="todays-photos-grid">
            {% for photo_of_day in todays_photos %}
            <div class="todays-photo-card">
                <div class="position-badge">Position {{ photo_of_day.position }}</div>
                {% if photo_of_day.photo.media_type == 'video' %}
                <video controls>
                    <source src="{{ url_for('static', filename='uploads/videos/' + photo_of_day.photo.filename) }}" type="video/mp4">
                </video>
                {% elif photo_of_day.photo.is_photobooth %}
                <img src="{{ url_for('static', filename='uploads/photobooth/' + photo_of_day.photo.filename) }}" alt="Today's Photo">
                {% else %}
                <img src="{{ url_for('static', filename='uploads/' + photo_of_day.photo.filename) }}" alt="Today's Photo">
                {% endif %}
                <div class="todays-photo-info">
                    <strong>{{ photo_of_day.photo.original_filename }}</strong><br>
                    by {{ photo_of_day.photo.uploader_name }}<br>
                    {{ photo_of_day.votes|length }} votes
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <div class="admin-controls">
        <form method="POST" action="{{ url_for('photo_of_day.clear_photo_of_day', key='wedding2024') }}" style="display: inline;">
            <button type="submit" class="admin-btn danger" onclick="return confirm('Are you sure you want to clear all today\'s Photos of the Day?')">
                üóëÔ∏è Clear All Today's Photos
            </button>
        </form>
    </div>
    {% else %}
    <div class="no-photo-message">
        <div class="icon">üì∏</div>
        <h3 style="font-family:'Playfair Display',serif;font-size:1.5rem;color:#8b7355;margin-bottom:0.5rem;">No Photos of the Day Set</h3>
        <p>Select photos below to set as today's Photos of the Day</p>
    </div>
    {% endif %}
</div>

<div class="admin-section-card">
    <div class="admin-section-title">Select Photo of the Day</div>
    <p style="color: #6b5d54; margin-bottom: 2rem;">Click on a photo below to set it as today's Photo of the Day. Choose position 1, 2, or 3.</p>
    
    <div class="photo-selection-grid">
        {% for photo in all_photos %}
        <div class="photo-selection-card" onclick="selectPhoto({{ photo.id }}, '{{ photo.original_filename }}')">
            <div class="photo-selection-media">
                {% if photo.media_type == 'video' %}
                <video>
                    <source src="{{ url_for('static', filename='uploads/videos/' + photo.filename) }}" type="video/mp4">
                </video>
                {% elif photo.is_photobooth %}
                <img src="{{ url_for('static', filename='uploads/photobooth/' + photo.filename) }}" alt="Photo">
                {% else %}
                <img src="{{ url_for('static', filename='uploads/' + photo.filename) }}" alt="Photo">
                {% endif %}
            </div>
            <div class="photo-selection-info">
                <div class="photo-selection-uploader">{{ photo.uploader_name }}</div>
                <div class="photo-selection-stats">
                    <span>‚ù§Ô∏è {{ photo.likes }}</span>
                    <span>{{ photo.upload_date | timezone_format('%b %d') }}</span>
                </div>
                <div class="position-selector">
                    <button type="button" class="position-btn" onclick="event.stopPropagation(); setPosition(1)">Position 1</button>
                    <button type="button" class="position-btn" onclick="event.stopPropagation(); setPosition(2)">Position 2</button>
                    <button type="button" class="position-btn" onclick="event.stopPropagation(); setPosition(3)">Position 3</button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{% if recent_photos %}
<div class="admin-section-card">
    <div class="admin-section-title">Recent Photos of the Day</div>
    <div class="recent-photos-grid">
        {% for photo_of_day in recent_photos %}
        <div class="recent-photo-card">
            <div class="recent-photo-media">
                {% if photo_of_day.photo.media_type == 'video' %}
                <video controls>
                    <source src="{{ url_for('static', filename='uploads/videos/' + photo_of_day.photo.filename) }}" type="video/mp4">
                </video>
                {% elif photo_of_day.photo.is_photobooth %}
                <img src="{{ url_for('static', filename='uploads/photobooth/' + photo_of_day.photo.filename) }}" alt="Photo of the Day">
                {% else %}
                <img src="{{ url_for('static', filename='uploads/' + photo_of_day.photo.filename) }}" alt="Photo of the Day">
                {% endif %}
                <div class="recent-photo-date">{{ photo_of_day.date | timezone_format('%b %d') }}</div>
            </div>
            <div class="recent-photo-info">
                <div class="uploader">by {{ photo_of_day.photo.uploader_name }}</div>
                <div class="stats">
                    <span>üì∏ Photo of the Day</span>
                    <span>{{ photo_of_day.votes|length }} votes</span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<script>
let selectedPosition = 1;

function setPosition(position) {
    selectedPosition = position;
    
    // Update button styles
    document.querySelectorAll('.position-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
}

function selectPhoto(photoId, photoName) {
    if (confirm(`Set "${photoName}" as today's Photo of the Day in position ${selectedPosition}?`)) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '{{ url_for("photo_of_day.set_photo_of_day", key="wedding2024") }}';
        
        const photoIdInput = document.createElement('input');
        photoIdInput.type = 'hidden';
        photoIdInput.name = 'photo_id';
        photoIdInput.value = photoId;
        
        const positionInput = document.createElement('input');
        positionInput.type = 'hidden';
        positionInput.name = 'position';
        positionInput.value = selectedPosition;
        
        form.appendChild(photoIdInput);
        form.appendChild(positionInput);
        document.body.appendChild(form);
        form.submit();
    }
}

// Highlight selected photos if there are current photos of the day
{% if todays_photos %}
document.addEventListener('DOMContentLoaded', function() {
    const currentPhotoIds = [{% for photo in todays_photos %}{{ photo.photo.id }}{% if not loop.last %}, {% endif %}{% endfor %}];
    const photoCards = document.querySelectorAll('.photo-selection-card');
    
    photoCards.forEach(card => {
        const onclickStr = card.onclick.toString();
        const match = onclickStr.match(/selectPhoto\((\d+)/);
        if (match && match[1]) {
            const photoId = parseInt(match[1]);
            if (currentPhotoIds.includes(photoId)) {
                card.classList.add('selected');
            }
        }
    });
});
{% endif %}

// Set default position
document.addEventListener('DOMContentLoaded', function() {
    setPosition(1);
});
</script>
{% endblock %} 